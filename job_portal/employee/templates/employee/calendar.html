{% extends base_template %}

{% block extra_css %}
<style>
    #calendar-container {
        width: 100%;
        max-width: 600px;
        margin: 20px auto;
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    #calendar {
        display: flex;
        flex-direction: column;
    }

    .calendar-header, .calendar-row {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
    }

    .calendar-header {
        background-color: #f4f4f4;
        font-weight: bold;
        text-align: center;
        padding: 8px 0;
    }

    .calendar-body {
        background-color: #fff;
    }

    .day {
        text-align: center;
        padding: 15px;
        border: 1px solid #ddd;
        cursor: pointer;
    }

    .day:hover {
        background-color: #f0f8ff;
    }

    .day.booked {
        background-color: #90ee90;
        color: #fff;
        font-weight: bold;
    }
</style>
{% endblock %}


{% block content %}

<h1>Your Booking Calendar</h1>
<div id="calendar-summary">
    <p id="booked-count">Total Booked Days: {{ total_booked }}</p>
</div>
<div id="calendar-container">
    <div id="calendar">
        <div class="calendar-header">
            <div>Sun</div>
            <div>Mon</div>
            <div>Tue</div>
            <div>Wed</div>
            <div>Thu</div>
            <div>Fri</div>
            <div>Sat</div>
        </div>
<div class="calendar-body">
    {% for week in calendar_weeks %}
        <div class="calendar-row">
            {% for day in week %}
                <div class="day {% if day.is_booked %}booked{% endif %}" data-date="{{ day.date }}">
                    {{ day.date|date:"d" }}
                    <br>
                    {% if day.is_booked %}
                        Booked
                    {% else %}
                        Free
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    {% endfor %}
</div>

{% endblock %}

{% block extra_js %}
<script>
document.querySelectorAll('.day').forEach(dayElement => {
    dayElement.addEventListener('click', () => {
        const date = dayElement.dataset.date; // Should be in YYYY-MM-DD format
        fetch(`/employee/calendar/toggle-booking/${date}/`, {
            method: 'POST',
            headers: { 'X-CSRFToken': '{{ csrf_token }}' },
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                // Toggle the visual state of the day
                dayElement.classList.toggle('booked');
                dayElement.innerHTML = `${data.date} - ${data.is_booked ? 'Booked' : 'Free'}`;

                // Update the total booked count
                const bookedCountElement = document.getElementById('booked-count');
                bookedCountElement.textContent = `Total Booked Days: ${data.total_booked}`;
            }
        });
    });
});

</script>
{% endblock %}
