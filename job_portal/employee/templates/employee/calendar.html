{% extends 'base.html' %}

  <!-- Load CSRF token library -->

{% block content %}
<h1>Your Calendar of January</h1>
<div class="calendar">
    {% for day in calendar_days %}
        <div class="day {% if day.is_free %}free{% else %}not-free{% endif %}"
             data-date="{{ day.date|date:'Y-m-d' }}">
            {{ day.date.day }}
        </div>
    {% endfor %}
</div>
{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function () {
        $('.day').click(function () {
            const dayElement = $(this);
            const date = dayElement.data('date');

            $.ajax({
                url: "{% url 'toggle_day_status' %}",
                type: "POST",
                data: {
                    date: date,
                    csrfmiddlewaretoken: '{{ csrf_token }}',  <!-- Include CSRF token here -->
                },
                success: function (response) {
                    if (response.success) {
                        if (response.is_free) {
                            dayElement.removeClass('not-free').addClass('free');
                        } else {
                            dayElement.removeClass('free').addClass('not-free');
                        }
                    } else {
                        alert("Failed to toggle the day's status: " + (response.error || "Unknown error"));
                    }
                },
                error: function () {
                    alert("An error occurred. Please try again.");
                }
            });
        });
    });
</script>
{% endblock %}
